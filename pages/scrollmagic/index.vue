<template>
  <div>
    <div class="scroll-element"></div>
    <section id="bar" class="styleguide segment">
      <div class="container container--narrow text">
        <div id="foo" class="indicator"></div>
        <h1>
          Fusce fringilla nisl sed eros finibus volutpat. Praesent convallis
          elit non sapien suscipit, quis pellentesque ligula egestas.
        </h1>
        <h2>
          Nullam aliquam erat nec ipsum accumsan euismod. Donec rhoncus orci non
          cursus porttitor.
        </h2>
        <h3>
          Phasellus ut nunc quis purus sagittis sagittis. Nam quis metus
          blandit, mollis neque sed, dignissim lectus. Sed viverra nibh quis
          sagittis maximus. Duis ac ligula eget ex sollicitudin aliquam sit amet
          in risus.
        </h3>
        <h4>
          Nulla lacinia risus a mattis mattis. Mauris elementum felis in
          sollicitudin dictum. Ut rhoncus neque ut volutpat aliquam. Donec id
          leo pretium, auctor urna vitae, pharetra mauris. Fusce sit amet dolor
          ut purus mollis tempor id eget nibh.
        </h4>
        <h5>
          Suspendisse sollicitudin diam et arcu viverra convallis. Fusce eu quam
          vitae est tempus porttitor. Maecenas volutpat urna sed nunc iaculis
          sagittis. Donec lacinia nisi maximus, mattis odio viverra, rhoncus
          metus.
        </h5>
        <p>
          Proin ultrices nibh eget condimentum facilisis. Nunc in lorem et mi
          facilisis vulputate. <strong>Morbi porta pellentesque</strong> nibh
          scelerisque auctor. Nunc enim lacus, ultricies in pharetra a,
          porttitor vel dui. Duis tincidunt rutrum lorem et porta. Nunc sit amet
          porta erat. Vivamus vel diam a neque dictum feugiat. Mauris ultrices
          scelerisque turpis sed porta. Nunc nec tempor massa.
        </p>
        <p>
          Proin auctor nisl mattis lorem varius mattis. Aliquam cursus dui non
          ullamcorper volutpat. Suspendisse quis dui in ante maximus fermentum
          ac vitae risus.
        </p>
      </div>
    </section>
    <section id="bing" class="styleguide segment segment--dark">
      <div class="container container--narrow text">
        <div id="bong" class="indicator"></div>
        <h1>
          Fusce fringilla nisl sed eros finibus volutpat. Praesent convallis
          elit non sapien suscipit, quis pellentesque ligula egestas.
        </h1>
        <h2>
          Nullam aliquam erat nec ipsum accumsan euismod. Donec rhoncus orci non
          cursus porttitor.
        </h2>
        <h3>
          Phasellus ut nunc quis purus sagittis sagittis. Nam quis metus
          blandit, mollis neque sed, dignissim lectus. Sed viverra nibh quis
          sagittis maximus. Duis ac ligula eget ex sollicitudin aliquam sit amet
          in risus.
        </h3>
        <h4>
          Nulla lacinia risus a mattis mattis. Mauris elementum felis in
          sollicitudin dictum. Ut rhoncus neque ut volutpat aliquam. Donec id
          leo pretium, auctor urna vitae, pharetra mauris. Fusce sit amet dolor
          ut purus mollis tempor id eget nibh.
        </h4>
        <h5>
          Suspendisse sollicitudin diam et arcu viverra convallis. Fusce eu quam
          vitae est tempus porttitor. Maecenas volutpat urna sed nunc iaculis
          sagittis. Donec lacinia nisi maximus, mattis odio viverra, rhoncus
          metus.
        </h5>
        <p>
          Proin ultrices nibh eget condimentum facilisis. Nunc in lorem et mi
          facilisis vulputate. <strong>Morbi porta pellentesque</strong> nibh
          scelerisque auctor. Nunc enim lacus, ultricies in pharetra a,
          porttitor vel dui. Duis tincidunt rutrum lorem et porta. Nunc sit amet
          porta erat. Vivamus vel diam a neque dictum feugiat. Mauris ultrices
          scelerisque turpis sed porta. Nunc nec tempor massa.
        </p>
        <p>
          Proin auctor nisl mattis lorem varius mattis. Aliquam cursus dui non
          ullamcorper volutpat. Suspendisse quis dui in ante maximus fermentum
          ac vitae risus.
        </p>
      </div>
    </section>
    <section id="bar" class="styleguide segment">
      <div class="container container--narrow text">
        <div id="foo" class="indicator"></div>
        <h1>
          Fusce fringilla nisl sed eros finibus volutpat. Praesent convallis
          elit non sapien suscipit, quis pellentesque ligula egestas.
        </h1>
        <h2>
          Nullam aliquam erat nec ipsum accumsan euismod. Donec rhoncus orci non
          cursus porttitor.
        </h2>
        <h3>
          Phasellus ut nunc quis purus sagittis sagittis. Nam quis metus
          blandit, mollis neque sed, dignissim lectus. Sed viverra nibh quis
          sagittis maximus. Duis ac ligula eget ex sollicitudin aliquam sit amet
          in risus.
        </h3>
        <h4>
          Nulla lacinia risus a mattis mattis. Mauris elementum felis in
          sollicitudin dictum. Ut rhoncus neque ut volutpat aliquam. Donec id
          leo pretium, auctor urna vitae, pharetra mauris. Fusce sit amet dolor
          ut purus mollis tempor id eget nibh.
        </h4>
        <h5>
          Suspendisse sollicitudin diam et arcu viverra convallis. Fusce eu quam
          vitae est tempus porttitor. Maecenas volutpat urna sed nunc iaculis
          sagittis. Donec lacinia nisi maximus, mattis odio viverra, rhoncus
          metus.
        </h5>
        <p>
          Proin ultrices nibh eget condimentum facilisis. Nunc in lorem et mi
          facilisis vulputate. <strong>Morbi porta pellentesque</strong> nibh
          scelerisque auctor. Nunc enim lacus, ultricies in pharetra a,
          porttitor vel dui. Duis tincidunt rutrum lorem et porta. Nunc sit amet
          porta erat. Vivamus vel diam a neque dictum feugiat. Mauris ultrices
          scelerisque turpis sed porta. Nunc nec tempor massa.
        </p>
        <p>
          Proin auctor nisl mattis lorem varius mattis. Aliquam cursus dui non
          ullamcorper volutpat. Suspendisse quis dui in ante maximus fermentum
          ac vitae risus.
        </p>
      </div>
    </section>
  </div>
</template>
<script>
import debounce from 'lodash/debounce'
export default {
  head: {
    title: 'Styleguide',
    link: [
      {
        rel: 'stylesheet',
        href:
          'https://fonts.googleapis.com/css?family=Crimson+Text&display=swap'
      }
    ]
  },
  mounted: function() {
    const ScrollMagic = this.$ScrollMagic
    const TimelineLite = this.$GSAP.TimelineLite

    /* --------------------------
     * Initialization
     * -------------------------- */
    function init() {
      scrollMagicInit()
    }

    /* --------------------------
     * Scroll Element
     * -------------------------- */
    let timeline
    function scrollElement() {
      timeline = new TimelineLite()
      timeline
        .to('.scroll-element', 1, {
          x: '-=100'
        })
        .to('.scroll-element', 1, {
          y: '-=100'
        })
    }

    /* --------------------------
     * Scroll magic
     * Getting an error referencing this issue:
     * https://github.com/janpaepke/ScrollMagic/wiki/WARNING:-tween-was-overwritten-by-another
     * -------------------------- */
    function scrollMagicInit() {
      const elements = document.querySelectorAll('.segment')
      Array.from(elements).forEach(function(element) {
        // Create timeline for each loop.
        scrollElement()

        /**
         * Vertical line
         */
        const verticalLineController = new ScrollMagic.Controller({
          globalSceneOptions: { duration: element.offsetHeight }
        })
        new ScrollMagic.Scene({ triggerElement: element, triggerHook: 0.5 })
          .setClassToggle(element.querySelector('.indicator'), 'active') // add class toggle
          .addTo(verticalLineController)

        /**
         * Scroll element
         */
        const scrollElementController = new ScrollMagic.Controller()
        new ScrollMagic.Scene({ triggerElement: element, triggerHook: 0.5 })
          .setTween(timeline)
          .addTo(scrollElementController)
      })
    }

    /* --------------------------
     * HELPER: Window Resize Debounce
     * -------------------------- */
    window.addEventListener(
      'resize',
      debounce(() => {
        scrollMagicInit()
        this.debounce()
      }, 200)
    )

    init()
  }
  // Uncomment to simulate a 1 second delay.
  // asyncData() {
  //   /* eslint-disable */
  //   return new Promise(resolve => {
  //     setTimeout(function() {
  //       resolve({ name: 'world' })
  //     }, 1000)
  //   })
  //   /* eslint-enable */
  // },
}
</script>

<style lang="scss" scoped>
@import '~/assets/scss/_variables.scss';
.indicator {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 5px;
  background-color: orange;
  transition: background-color 1s;

  &.active {
    background-color: rebeccapurple !important;
  }
  .segment--dark & {
    background-color: crimson;
  }
}
.scroll-element {
  position: fixed;
  right: 0;
  bottom: 0;
  width: 100px;
  height: 100px;
  background-color: tomato;
}
</style>
